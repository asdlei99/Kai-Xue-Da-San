# 词法分析

### 一、分工

我负责的模块是词法分析的部分。词法分析是编译的第一个阶段，词法分析有两个功能：

**识别单词**

从写好源程序的文本文件中以单个字符的形式读取直到结束，这个过程依照自动机从源程序中识别单词，在词法分析内部会依照读取字符的不同，决定要采取的动作，比如跳过字符、存储字符，最后根据状态的不同，输出单词到符号表或Token串。

**翻译单词**

将单词存储为对应的Token序列，并将标识符、常数等先写入符号表的name部分。

### 二、设计

**数据结构**

+ 关键字表和界符表用了STL中的map
+ phrase数组用来存储每一次读到的字符，进而判别单词
+ Token属于vector<token>类型，用来存储生成的Token串
+ state用int表示当前自动机的状态
+ 把KT和PT放在了二维数组中，方便寻找

**常数处理机**

对于1.5e^-3^这样的数字，在词法分析时候算作整体一个token串放入常数表中。

A:Em		B:EnSign		C:En		D:EnSign En		，则表示形式为$Ae^D$

```c++
bool hasE=false;//是否是指数
float Em=0;//Em*e^En
int En=0;
bool EnSign=true;//true En前面数字为正数，false En前面数字为负数
```

### 三、函数功能

findToken(char phrase[])为寻找合法字符串并返回Token序列，具体方法是当这个类型是char时候，先修改当前用于判断char类型的bool IsChar为假，进而填入符号表和压入Token序列中，主要用了push_back函数。

stateChange(char ch)为状态转换函数，已知当前状态，得到一个char类型字符ch时候，根据ch来判断下一步自动机的状态，改变state的状态，返回一个数值，根据当前的数值，程序判断是否继续读字符。

**由于词法分析函数和填写符号表紧密结合，这里先不贴出代码。**

### 四、问题及解决方案

在设计如何实现词法分析过程中遇到了一些问题，经过和组长协商，选择使用自动机的方法，通过查看当前状态和读入的字符，来判断下一个状态的标号，这种结构较于while/if的方法更加容易深入我对自动机的理解，另外时间复杂度更低，而且debug时候只要对着图纸查看编号是否正确就可以，思路更清晰。

### 五、下一步工作计划

和组长研究插入语义动作文法，讨论如何生成目标代码，辅助权凇同学对界面优化。